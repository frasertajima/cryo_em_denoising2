!================================================================
! Dimension Debug Test
!================================================================
program test_dimensions
    use cudafor
    use conv2d_cudnn
    use iso_c_binding
    implicit none

    interface
        function cudnnCreate(handle) bind(c, name='cudnnCreate')
            import :: c_ptr, c_int
            type(c_ptr) :: handle
            integer(c_int) :: cudnnCreate
        end function cudnnCreate
    end interface

    integer, parameter :: IMAGE_SIZE = 64
    integer, parameter :: BATCH_SIZE = 1

    type(c_ptr) :: cudnn_handle
    type(conv2d_layer_t) :: conv
    integer :: stat

    print *, "========================================"
    print *, "  Dimension Debug"
    print *, "========================================"
    print *, ""

    stat = cudnnCreate(cudnn_handle)
    call conv2d_init(conv, cudnn_handle, 1, 1, 3, 1, 1, BATCH_SIZE, IMAGE_SIZE, IMAGE_SIZE, use_relu=.false.)

    print *, "Layer configuration:"
    print *, "  in_channels:", conv%in_channels
    print *, "  out_channels:", conv%out_channels
    print *, "  kernel_size:", conv%kernel_size
    print *, "  padding:", conv%padding
    print *, "  stride:", conv%stride
    print *, "  batch_size:", conv%batch_size
    print *, "  in_height:", conv%in_height
    print *, "  in_width:", conv%in_width
    print *, "  out_height:", conv%out_height
    print *, "  out_width:", conv%out_width
    print *, ""

    print *, "Weight array shape: (out_ch, in_ch, k, k)"
    print *, "  Shape:", shape(conv%weights)
    print *, "  Total elements:", size(conv%weights)
    print *, ""

    print *, "Bias array shape: (out_ch)"
    print *, "  Shape:", shape(conv%bias)
    print *, "  Total elements:", size(conv%bias)
    print *, ""

    call conv2d_cleanup(conv)

end program test_dimensions
